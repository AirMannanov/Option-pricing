# Информационная аннотация: Модель Блэка-Шоулза

## Что такое опцион?

**Опцион** — это финансовый инструмент, дающий право (но не обязательство) купить или продать базовый актив по заранее определённой цене (страйк) в течение определённого периода времени или в определённую дату (экспирация).

### Типы опционов

1. **Call опцион (опцион на покупку)** — даёт право купить базовый актив по страйку
2. **Put опцион (опцион на продажу)** — даёт право продать базовый актив по страйку

### Основные параметры опциона

- $S$ (Spot) — текущая цена базового актива
- $K$ (Strike) — страйк-цена опциона
- $T$ (Time to Expiration) — время до экспирации (в годах)
- $r$ (Risk-free rate) — безрисковая процентная ставка (годовая)
- $\sigma$ (Sigma, Volatility) — волатильность базового актива (годовая)

## Модель Блэка-Шоулза

Модель Блэка-Шоулза — это математическая модель для оценки справедливой стоимости европейских опционов. Модель была разработана Фишером Блэком и Майроном Шоулзом в 1973 году.

### Основные предположения модели

1. Базовый актив следует геометрическому броуновскому движению
2. Волатильность постоянна в течение срока действия опциона
3. Безрисковая процентная ставка постоянна
4. Нет дивидендов по базовому активу
5. Нет транзакционных издержек
6. Непрерывное торговое время

## Формулы расчёта

### Вспомогательные параметры d₁ и d₂

Перед расчётом цены опциона вычисляются два вспомогательных параметра:

**d₁:**
$$d_1 = \frac{\ln(S/K) + (r + \sigma^2/2) \cdot T}{\sigma \sqrt{T}}$$

**d₂:**
$$d_2 = d_1 - \sigma \sqrt{T}$$

где:
- $\ln$ — натуральный логарифм
- $\sqrt{T}$ — квадратный корень из времени до экспирации

### Цена Call опциона

$$C = S \cdot N(d_1) - K \cdot e^{-rT} \cdot N(d_2)$$

где:
- $N(x)$ — функция стандартного нормального распределения (CDF)
- $e^{-rT}$ — коэффициент дисконтирования

### Цена Put опциона

$$P = K \cdot e^{-rT} \cdot N(-d_2) - S \cdot N(-d_1)$$

### Функция стандартного нормального распределения (CDF)

В коде используется аппроксимация Абрамовица и Стегуна:

$$N(x) = 0.5 \cdot (1 + \text{sign} \cdot y)$$

где:
- $\text{sign} = 1$ если $x \geq 0$, иначе $\text{sign} = -1$
- $t = \frac{1}{1 + p \cdot |x|}$
- $y = 1 - (((((a_5 \cdot t + a_4) \cdot t) + a_3) \cdot t + a_2) \cdot t + a_1) \cdot t \cdot e^{-x^2}$

### Плотность вероятности стандартного нормального распределения (PDF)

$$\phi(x) = \frac{1}{\sqrt{2\pi}} \cdot e^{-\frac{x^2}{2}}$$

где:
- $\frac{1}{\sqrt{2\pi}} \approx 0.3989422804014327$

## Константы

### Константы аппроксимации CDF (Абрамовиц и Стегун)

```cpp
const double a1 =  0.254829592;
const double a2 = -0.284496736;
const double a3 =  1.421413741;
const double a4 = -1.453152027;
const double a5 =  1.061405429;
const double p  =  0.3275911;
```

### Константа для PDF

```cpp
const double inv_sqrt_2pi = 0.3989422804014327;  // 1 / sqrt(2 * pi)
```

## Греки (Greeks)

Греки — это показатели чувствительности цены опциона к изменению различных параметров.

### Delta (Δ)

Изменение цены опциона при изменении цены базового актива на единицу.

**Call опцион:**
$$\Delta = N(d_1)$$

**Put опцион:**
$$\Delta = N(d_1) - 1$$

### Gamma (Γ)

Изменение Delta при изменении цены базового актива на единицу.

$$\Gamma = \frac{\phi(d_1)}{S \cdot \sigma \cdot \sqrt{T}}$$

где $\phi(x)$ — плотность вероятности стандартного нормального распределения.

### Vega (ν)

Изменение цены опциона при изменении волатильности на 1% (0.01).

$$\nu = S \cdot \phi(d_1) \cdot \sqrt{T}$$

### Theta (Θ)

Изменение цены опциона при уменьшении времени до экспирации на один день (обычно выражается в годовом исчислении).

**Call опцион:**
$$\Theta = -\frac{S \cdot \phi(d_1) \cdot \sigma}{2 \sqrt{T}} - r \cdot K \cdot e^{-rT} \cdot N(d_2)$$

**Put опцион:**
$$\Theta = -\frac{S \cdot \phi(d_1) \cdot \sigma}{2 \sqrt{T}} + r \cdot K \cdot e^{-rT} \cdot N(-d_2)$$

### Rho (ρ)

Изменение цены опциона при изменении безрисковой ставки на 1% (0.01).

**Call опцион:**
$$\rho = K \cdot T \cdot e^{-rT} \cdot N(d_2)$$

**Put опцион:**
$$\rho = -K \cdot T \cdot e^{-rT} \cdot N(-d_2)$$

## Обработка граничных случаев

### Время до экспирации равно нулю ($T = 0$)

При экспирации опцион имеет только внутреннюю стоимость:

**Call опцион:**
$$C = \max(S - K, 0)$$

**Put опцион:**
$$P = \max(K - S, 0)$$

### Нулевая волатильность ($\sigma = 0$)

При нулевой волатильности опцион имеет дисконтированную внутреннюю стоимость:

**Call опцион:**
$$C = \max(S - K \cdot e^{-rT}, 0)$$

**Put опцион:**
$$P = \max(K \cdot e^{-rT} - S, 0)$$

## Реализация в коде

### Основные методы класса `BlackScholesModel`

- `price()` — расчёт цены опциона
- `priceWithGreeks()` — расчёт цены опциона со всеми греками
- `normalCDF(x)` — функция стандартного нормального распределения
- `normalPDF(x)` — плотность вероятности стандартного нормального распределения
- `calculateD1()`, `calculateD2()` — расчёт вспомогательных параметров
- `calculateCallPrice()`, `calculatePutPrice()` — расчёт цен опционов
- `calculateDelta()`, `calculateGamma()`, `calculateVega()`, `calculateTheta()`, `calculateRho()` — расчёт греков

### Входные данные

- **Option** — опцион (тип, страйк, время до экспирации)
- **MarketData** — рыночные данные (цена актива, безрисковая ставка, волатильность)

### Выходные данные

- **PricingResult** — результат расчёта:
  - `price` — цена опциона
  - `delta` — чувствительность к цене актива
  - `gamma` — чувствительность Delta к цене актива
  - `vega` — чувствительность к волатильности
  - `theta` — чувствительность ко времени
  - `rho` — чувствительность к процентной ставке

## Примечания

1. Все временные параметры выражаются в годах
2. Процентные ставки и волатильность задаются в десятичном виде (например, 5% = 0.05)
3. Модель применима только для европейских опционов (нельзя исполнить до экспирации)
4. Модель не учитывает дивиденды по базовому активу
5. Греки рассчитываются в годовом исчислении (кроме Theta, который также в годовом исчислении)
